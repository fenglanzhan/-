# 浏览器加载解析渲染机制(本篇文章将基于webkit来讨论浏览器工作原理)
## 浏览器的高级结构
浏览器主要组件：
1. 用户界面user interface：除了显示请求页面主窗口的其他可见内容
2. 浏览器引擎 browser engine：用来查询及操作渲染引擎的接口
3. 渲染引擎rendering engine：我们常说的内核，用来显示请求的内容，例如html文件，解析html和css，并将解析后的结果渲染出来
4. 网络networking：网络调用
5. UI后端ui backend：绘制浏览器的基本组件
6. JS解释器js interpreter：解释执行js代码
7. 数据存储data storage：浏览器用来存储cookie等数据  
不同大部分浏览器，chrome为每个tab提供了渲染引擎实例，每个tab是独立的进程  
渲染引擎是单线程的，除了网络操作以外，几乎所有的事情都在单一的线程中处理，在Firefox和Safari中，这是浏览器的主线程，Chrome中这是tab的主线程  
网络操作由几个并行线程执行，并行连接的个数是受限的（通常是2－6个）

## 主流程
简述：渲染引擎在获取内容后，解析html文档，将标签转化为DOM节点并构建DOM Tree，当解析外部CSS文件和style标签的样式信息时，生成CSSOM Tree，  
结合生成Render Tree，执行布局过程，确定节点位置，遍历render tree进行绘制。
这个过程是逐步完成的，为了更好的用户体验，渲染引擎将会尽可能早的将内容呈现到屏幕上，并不会等到所有的html都解析完成之后再去构建和布局render tree。  
它是解析完一部分内容就显示一部分内容，同时，可能还在通过网络下载其余内容。
## HTML下载解析
DOM树构建时会阻塞的情况：
1. HTML响应流被阻塞在网络中
2. 有未加载完的脚本
3. 遇到script节点，但有未加载完成的样式文件
DomContentLoaded触发的时间(我的理解是DOM树构建完毕)：当文档被完全加载和解析时，DOMContentLoed事件就会被触发，  
而无需等待样式表、图像和节点完成加载(Load事件可用于检测满载页面)
## CSS下载解析
html解析过程中，遇到style标签会直接解析，如果是link的外部样式，会去加载样式表
理解：理论上外部样式表并不会修改DOM树，看似没有必要停止文档解析去加载样式表。我们可以这样理解：js中可能会修改或者请求样式信息，  
如果样式文件没有加载和解析完成，js获取的样式信息就会出错。实际上FF在样式表在加载和解析时会停止所有脚本，chrome只有在脚本尝试访问某些可能被  
加载的样式表所影响的特定样式属性才阻塞脚本(有点高能啊，怎么做到的)。
外部样式表加载和解析会阻塞js的加载还是执行
## JS下载解析执行
web的模式是同步的，开发者希望解析到一个script标签时立即解析执行脚本，并阻塞文档的解析直到脚本执行完。如果是外部资源，会阻塞文档的解析直到资源被请求到。
预解析：当执行脚本时，另一个线程解析剩下的文档，并加载后面需要通过网络加载的资源。这种方式可以使资源并行加载从而使整体速度更快。  
需要注意的是，预解析并不改变Dom树，它将这个工作留给主解析过程，自己只解析外部资源的引用，比如外部脚本、样式表及图片。
## 
